<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>corva-sdk :: corva-sdk</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">corva-sdk</a>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="corva-sdk" data-version="1.8.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">corva-sdk</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">corva-sdk</span>
    <span class="version">1.8.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">corva-sdk</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.8.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link is-current"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">corva-sdk</a></li>
    <li><a href="index.html">Home</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/corva-ai/python-sdk/blob/v1.8.1/docs/modules/ROOT/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="5">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page"><a href="https://github.com/corva-ai/python-sdk">corva-sdk</a></h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Documentation for version <strong>1.8.1</strong>.</p>
</div>
<div class="paragraph">
<p><strong>corva-sdk</strong> is a framework for building <a href="https://app.corva.ai/dev-center/docs">Corva DevCenter</a> Python apps.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install"><a class="anchor" href="#_install"></a>1. Install</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>corva-sdk</strong> requires Python 3.8.</p>
</div>
<div class="paragraph">
<p>Installation is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install corva-sdk</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app_types"><a class="anchor" href="#app_types"></a>2. App Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three app types that you can build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#stream"><code>stream</code></a> - works with real-time data.</p>
</li>
<li>
<p><a href="#scheduled"><code>scheduled</code></a> - works with data at defined schedules/intervals
(e.g., once a minute, once every 3 ft.).</p>
</li>
<li>
<p><a href="#task"><code>task</code></a> - works with data on-demand.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use type hints like in examples below
for better support from editors and tools.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="stream"><a class="anchor" href="#stream"></a>2.1. Stream</h3>
<div class="paragraph">
<p>Stream apps can be
<a href="#stream_time">time</a> or <a href="#stream_depth">depth</a> based.</p>
</div>
<div class="sect3">
<h4 id="stream_time"><a class="anchor" href="#stream_time"></a>2.1.1. Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, StreamTimeEvent, stream  <i class="conum" data-value="1"></i><b>(1)</b>


@stream  <i class="conum" data-value="3"></i><b>(3)</b>
def stream_time_app(event: StreamTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="2"></i><b>(2)</b>
    return "Hello, World!"  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function. It must receive three argumets: <a href="#event">event</a>, <a href="#api">api</a> and <a href="#cache">cache</a>. The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>stream</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="stream_depth"><a class="anchor" href="#stream_depth"></a>2.1.2. Depth</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, StreamDepthEvent, stream  <i class="conum" data-value="1"></i><b>(1)</b>


@stream  <i class="conum" data-value="3"></i><b>(3)</b>
def stream_depth_app(event: StreamDepthEvent, api: Api, cache: Cache):  <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello, World!'  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function. It must receive three argumets: <a href="#event">event</a>, <a href="#api">api</a> and <a href="#cache">cache</a>. The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>stream</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduled"><a class="anchor" href="#scheduled"></a>2.2. Scheduled</h3>
<div class="paragraph">
<p>Scheduled apps can be
<a href="#scheduled_time">data time</a>,
<a href="#scheduled_depth">depth</a>
or <a href="#scheduled_natural">natural time</a> based.</p>
</div>
<div class="sect3">
<h4 id="scheduled_time"><a class="anchor" href="#scheduled_time"></a>2.2.1. Data Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled  <i class="conum" data-value="1"></i><b>(1)</b>


@scheduled  <i class="conum" data-value="3"></i><b>(3)</b>
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello, World!'  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function. It must receive three argumets: <a href="#event">event</a>, <a href="#api">api</a> and <a href="#cache">cache</a>. The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>scheduled</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduled_depth"><a class="anchor" href="#scheduled_depth"></a>2.2.2. Depth</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDepthEvent, scheduled  <i class="conum" data-value="1"></i><b>(1)</b>


@scheduled  <i class="conum" data-value="3"></i><b>(3)</b>
def scheduled_app(event: ScheduledDepthEvent, api: Api, cache: Cache):  <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello, World!'  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function. It must receive three argumets: <a href="#event">event</a>, <a href="#api">api</a> and <a href="#cache">cache</a>. The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>scheduled</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scheduled_natural"><a class="anchor" href="#scheduled_natural"></a>2.2.3. Natural Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledNaturalTimeEvent, scheduled  <i class="conum" data-value="1"></i><b>(1)</b>


@scheduled  <i class="conum" data-value="3"></i><b>(3)</b>
def scheduled_app(event: ScheduledNaturalTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello, World!'  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function. It must receive three argumets: <a href="#event">event</a>, <a href="#api">api</a> and <a href="#cache">cache</a>. The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>scheduled</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task"><a class="anchor" href="#task"></a>2.3. Task</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task  <i class="conum" data-value="1"></i><b>(1)</b>


@task  <i class="conum" data-value="3"></i><b>(3)</b>
def task_app(event: TaskEvent, api: Api):  <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello, World!'  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import required functionality.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define your function.
It must receive two arguments:
<a href="#event">event</a> and <a href="#api">api</a>.
The arguments serve as building blocks for your app.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorate your function using <code>task</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add app logic here.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="event"><a class="anchor" href="#event"></a>3. Event</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Event is an object that contains essential data for the app.
Each <a href="#app_types">app type</a> has its corresponding event type,
which only contains fields relevant to that app.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api"><a class="anchor" href="#api"></a>4. Api</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apps should be able to communicate with
<a href="https://api.corva.ai/documentation/index.html">Corva Platform API</a> and <a href="https://data.corva.ai/docs#/">Corva Data API</a>.
For this <strong>corva-sdk</strong> provides an <code>Api</code> object,
which wraps Python <code>requests</code> library
and adds automatic authorization, convenient URL usage
and reasonable timeouts to API requests.
<code>Api</code> methods return <code>requests.Response</code> objects.</p>
</div>
<div class="sect2">
<h3 id="_url_usage"><a class="anchor" href="#_url_usage"></a>4.1. Url usage</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):
    api.get('/v2/pads')  <i class="conum" data-value="1"></i><b>(1)</b>
    api.get('/api/v1/data/provider/dataset/')  <i class="conum" data-value="2"></i><b>(2)</b>
    api.get('https://api.corva.ai/v2/pads')  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <a href="https://api.corva.ai/documentation/index.html">Corva Platform API</a> URL suffix
to make a Platform API call.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <a href="https://data.corva.ai/docs#/">Corva Data API</a> URL suffix
to make a Data API call.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can also provide full URL.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_http_get"><a class="anchor" href="#_http_get"></a>4.2. HTTP GET</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):
    response = api.get('/v2/pads')  <i class="conum" data-value="1"></i><b>(1)</b>
    api.get('/v2/pads', params={'company': 1})  <i class="conum" data-value="2"></i><b>(2)</b>

    response.json()  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simplest GET example.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use optional <code>params</code> parameter
to provide URL query string params.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can unpack received data like this,
as all <code>Api</code> methods return <code>requests.Response</code> objects.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_http_post_delete_put_and_patch"><a class="anchor" href="#_http_post_delete_put_and_patch"></a>4.3. HTTP POST, DELETE, PUT and PATCH</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):
    api.post('/v2/pads', data={'key': 'val'})  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="5"></i><b>(5)</b>
    api.delete('/v2/pads/123')  <i class="conum" data-value="2"></i><b>(2)</b>
    api.put('/api/v1/data/provider/dataset/', data={'key': 'val'})  <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="5"></i><b>(5)</b>
    api.patch('/v2/pads/123', data={'key': 'val'})  <i class="conum" data-value="4"></i><b>(4)</b> <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simplest POST example.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Simplest DELETE example.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Simplest PUT example.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Simplest PATCH example.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use <code>data</code> parameter
to provide a request body,
that will be cast to json.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_headers_and_timeouts"><a class="anchor" href="#_custom_headers_and_timeouts"></a>4.4. Custom headers and timeouts</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):
    api.get('/v2/pads', headers={'header': 'header-value'})  <i class="conum" data-value="1"></i><b>(1)</b>
    api.get('/v2/pads', timeout=5)  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>headers</code> parameter
to add custom headers to the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>timeout</code> parameter
to override default timeout value.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_convenience_methods"><a class="anchor" href="#_convenience_methods"></a>4.5. Convenience methods</h3>
<div class="paragraph">
<p><code>Api</code> provides some convenience methods
for frequently used endpoints.</p>
</div>
<div class="sect3">
<h4 id="_get_dataset"><a class="anchor" href="#_get_dataset"></a>4.5.1. Get dataset</h4>
<div class="paragraph">
<p>Fetch the data from the
<a href="https://data.corva.ai/docs#/default/index_api_v1_data__provider___dataset___get">/api/v1/data/provider/dataset/</a> endpoint
using <code>Api.get_dataset</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):
    api.get_dataset(
        provider='corva',
        dataset='wits',
        query={
            'asset_id': event.asset_id,
        },
        sort={'timestamp': 1},
        limit=1,
        fields='data,metadata',
    )</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="produce_messages"><a class="anchor" href="#produce_messages"></a>4.5.2. Produce messages</h4>
<div class="paragraph">
<p>Post data to the <a href="https://data.qa.corva.ai/docs#/data/produce_api_v1_message_producer__post">/api/v1/message_producer/</a> endpoint
using <code>Api.produce_messages</code> method.
The method will work for both
<a href="#stream"><code>stream</code></a>
and <a href="#scheduled"><code>scheduled</code></a> types of apps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, ScheduledDepthEvent, scheduled


@scheduled
def scheduled_time_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    api.produce_messages(data=[{'timestamp': 1}, {'timestamp': 2}])  <i class="conum" data-value="1"></i><b>(1)</b>


@scheduled
def scheduled_depth_app(event: ScheduledDepthEvent, api: Api, cache: Cache):
    api.produce_messages(data=[{'measured_depth': 1.0}, {'measured_depth': 2.0}])  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Example of producing time messages.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Example of producing depth messages.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="insert_data"><a class="anchor" href="#insert_data"></a>4.5.3. Insert data</h4>
<div class="paragraph">
<p>Post data to the
<a href="https://data.qa.corva.ai/docs#/data/create_api_v1_data__provider___dataset___post">/api/v1/data/provider/dataset/</a>
endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    api.insert_data(
        provider='my-company-name',
        dataset='my-datset-name',
        data=[
            {
                'asset_id': event.asset_id,
                'version': 1,
                'timestamp': 0,
                'data': {'result': 'very important result'},
            },
            {
                'asset_id': event.asset_id,
                'version': 1,
                'timestamp': 1,
                'data': {'result': 'very important result'},
            },
        ],  <i class="conum" data-value="1"></i><b>(1)</b>
        produce=True,  <i class="conum" data-value="2"></i><b>(2)</b>
    )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save two documents to dataset.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can enable this flag
to save and <a href="#produce_messages"><code>produce</code></a> the data at once.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cache"><a class="anchor" href="#cache"></a>5. Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apps might need to share some data between invokes.
For this <strong>corva-sdk</strong> provides a <code>Cache</code> object.
<code>Cache</code> uses a dict-like database,
so the data is stored as <code>key:value</code> pairs.</p>
</div>
<div class="paragraph">
<p>A typical example of <code>Cache</code> usage is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Store some data during <code>app invoke 1</code>.</p>
</li>
<li>
<p>Retrieve and use the data during <code>app invoke 2</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To get the most out of <code>Cache</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Store as small amounts of data as possible.</p>
</li>
<li>
<p>Try to stay below <code>100kb</code>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#task">Task</a> apps don&#8217;t get a <code>Cache</code> parameter
as they aren&#8217;t meant to share the data between invokes.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_get_and_set"><a class="anchor" href="#_get_and_set"></a>5.1. Get and set</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>Cache</code> can store only string data.</p>
</div>
<div class="paragraph">
<p>Cast your data to <code>str</code> before saving.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_storing_str"><a class="anchor" href="#_storing_str"></a>5.1.1. Storing <code>str</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    cache.set(key='str', value='text')  <i class="conum" data-value="1"></i><b>(1)</b>
    assert cache.get(key='str') == 'text'  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save <code>str</code> data to <code>Cache</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the value using its key.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_storing_int"><a class="anchor" href="#_storing_int"></a>5.1.2. Storing <code>int</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    cache.set(key='int', value=str(0))  <i class="conum" data-value="1"></i><b>(1)</b>
    assert cache.get('int') == '0'  <i class="conum" data-value="2"></i><b>(2)</b>
    assert int(cache.get('int')) == 0  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cast <code>int</code> to <code>str</code> before saving data to <code>Cache</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the value using its key.
Notice that returned value has <code>str</code> type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Cast the value back to <code>int</code> as needed.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_storing_dict"><a class="anchor" href="#_storing_dict"></a>5.1.3. Storing <code>dict</code></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import json

from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    cache.set(key='json', value=json.dumps({'int': 0, 'str': 'text'}))  <i class="conum" data-value="1"></i><b>(1)</b>
    assert isinstance(cache.get('json'), str)  <i class="conum" data-value="2"></i><b>(2)</b>
    assert json.loads(cache.get('json')) == {'int': 0, 'str': 'text'}  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cast <code>dict</code> to JSON <code>str</code> before saving data to <code>Cache</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the value using its key.
Notice that returned value has <code>str</code> type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Parse JSON <code>str</code>
and convert it back into a <code>dict</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete"><a class="anchor" href="#_delete"></a>5.2. Delete</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    cache.set(key='str', value='text')  <i class="conum" data-value="1"></i><b>(1)</b>
    assert cache.get(key='str') == 'text'  <i class="conum" data-value="2"></i><b>(2)</b>

    cache.delete(key='str')  <i class="conum" data-value="3"></i><b>(3)</b>
    assert cache.get(key='str') is None  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save some data to <code>Cache</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the value using its key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Delete the data,
when it is no longer needed.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The data is not present anymore.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_key_expiry"><a class="anchor" href="#_key_expiry"></a>5.3. Key expiry</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, keys expire in 60 days.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import time

from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    cache.set(key='key', value='value', ttl=1)  <i class="conum" data-value="1"></i><b>(1)</b>
    assert cache.get('key') == 'value'

    time.sleep(1)  <i class="conum" data-value="2"></i><b>(2)</b>

    assert cache.get('key') is None  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify how many seconds you want your key to live
using <code>ttl</code> parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Wait for key to expire.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The data is not present anymore.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bulk_methods"><a class="anchor" href="#_bulk_methods"></a>5.4. Bulk methods</h3>
<div class="paragraph">
<p><code>Cache</code> provides some bulk methods
which make it easy to work with multiple
keys at once.</p>
</div>
<div class="sect3">
<h4 id="_get_many_get_all_and_set_many"><a class="anchor" href="#_get_many_get_all_and_set_many"></a>5.4.1. Get many, get all and set many</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import time

from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    assert cache.get_all() == {}  <i class="conum" data-value="1"></i><b>(1)</b>

    cache.set_many(  <i class="conum" data-value="2"></i><b>(2)</b>
        data=[
            ('key', 'value_1'),
            ('key_with_custom_expiry', 'value_2', 1),  <i class="conum" data-value="3"></i><b>(3)</b>
        ]
    )

    assert cache.get_many(  <i class="conum" data-value="4"></i><b>(4)</b>
        keys=[
            'key',
            'non-existent-key',  <i class="conum" data-value="5"></i><b>(5)</b>
        ]
    ) == {'key': 'value_1', 'non-existent-key': None}

    assert cache.get_all() == {  <i class="conum" data-value="6"></i><b>(6)</b>
        'key': 'value_1',
        'key_with_custom_expiry': 'value_2',
    }

    time.sleep(1)  <i class="conum" data-value="7"></i><b>(7)</b>

    assert cache.get_all() == {'key': 'value_1'}  <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get all the data from the hash.
It is empty as we have not stored anything yet.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Store multiple key-value pairs at once.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can set custom key expiry in seconds
by providing additional tuple element.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get multiple keys at once.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If you request a non-existent key
it will be assigned a value of <code>None</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Get all the data from the hash.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Wait for key with custom expiry to expire.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The expired key is not present anymore.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_delete_many_and_delete_all"><a class="anchor" href="#_delete_many_and_delete_all"></a>5.4.2. Delete many and delete all</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    assert cache.get_all() == {}  <i class="conum" data-value="1"></i><b>(1)</b>

    cache.set_many(data=[('k1', 'v1'), ('k2', 'v2'), ('k3', 'v3'), ('k4', 'v4')])  <i class="conum" data-value="2"></i><b>(2)</b>

    cache.delete_many(keys=['k1', 'k2'])  <i class="conum" data-value="3"></i><b>(3)</b>
    assert cache.get_all() == {'k3': 'v3', 'k4': 'v4'}  <i class="conum" data-value="4"></i><b>(4)</b>

    cache.delete_all()  <i class="conum" data-value="5"></i><b>(5)</b>
    assert cache.get_all() == {}  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cache is empty as we have not stored anything yet.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Store some data.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Delete multiple keys at once.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Deleted keys are non-existent anymore.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Delete all the data.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Cache is empty.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logging"><a class="anchor" href="#_logging"></a>6. Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As apps are executed very frequently
(once a second or so),
unlimited logging can lead to huge amounts of data.
<strong>corva-sdk</strong> provides a <code>Logger</code> object,
which is a safe way for app logging.</p>
</div>
<div class="paragraph">
<p>The <code>Logger</code> is a <code>logging.Logger</code> instance
and should be used like every other Python logger.</p>
</div>
<div class="paragraph">
<p>The <code>Logger</code> has following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log messages are injected with contextual information,
which makes it easy to filter through logs
while debugging issues.</p>
</li>
<li>
<p>Log messages have limited length.
Too long messages are truncated to not exceed the limit.
Max message size can be controlled by
<code>LOG_THRESHOLD_MESSAGE_SIZE</code> env variable.
Default value is <code>1000</code> symbols or bytes.</p>
</li>
<li>
<p>Number of log messages is limited.
After reaching the limit logging gets disabled.
Number of log messages can be controlled by
<code>LOG_THRESHOLD_MESSAGE_COUNT</code> env variable.
Default value is <code>15</code> messages.</p>
</li>
<li>
<p>Logging level can be set using <code>LOG_LEVEL</code> env variable.
Default value is <code>INFO</code>,
see <a href="https://docs.python.org/3/howto/logging.html">Python log levels</a> for other available options.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Logger, TaskEvent, task  <i class="conum" data-value="1"></i><b>(1)</b>


@task
def task_app(event: TaskEvent, api: Api):
    <i class="conum" data-value="2"></i><b>(2)</b>
    Logger.debug('Debug message!')
    Logger.info('Info message!')
    Logger.warning('Warning message!')
    Logger.error('Error message!')
    try:
        0 / 0
    except ZeroDivisionError:
        Logger.exception('Exception message!')</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>Logger</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>Logger</code> as every other Python logger.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizations"><a class="anchor" href="#_customizations"></a>6.1. Customizations</h3>
<div class="paragraph">
<p>You might want to send logs to other places
(e.g., to error reporting systems like
<a href="#sentry"><code>Sentry</code></a> or <a href="#rollbar"><code>Rollbar</code></a>).
This can be achieved by providing an instance of
<a href="https://docs.python.org/3/howto/logging.html#handlers">logging handler</a>
as an argument to app decorator.
Custom handler will be used alongside <strong>corva-sdk</strong>'s default one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import logging  <i class="conum" data-value="1"></i><b>(1)</b>

from corva import Api, Logger, TaskEvent, task

stream_handler = logging.StreamHandler()  <i class="conum" data-value="2"></i><b>(2)</b>


@task(handler=stream_handler)  <i class="conum" data-value="3"></i><b>(3)</b>
def task_app(event: TaskEvent, api: Api):
    Logger.info('Info message!')  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the module which contains the handler
that we want to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize the handler.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pass the handler as a keyword argument to the app decorator.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Logs will be sent to both <code>stream_handler</code>
and <strong>corva-sdk</strong>'s default one.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sentry"><a class="anchor" href="#sentry"></a>6.1.1. Sentry</h4>
<div class="paragraph">
<p><a href="https://docs.sentry.io/platforms/python/">
Sentry for Python documentation.
</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install sentry-sdk <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install the library.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import sentry_sdk  <i class="conum" data-value="1"></i><b>(1)</b>

from corva import Api, TaskEvent, task

sentry_sdk.init("YOUR_SENTRY_DSN")  <i class="conum" data-value="2"></i><b>(2)</b>


@task
def app(event: TaskEvent, api: Api) -&gt; None:
    1 / 0  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import Sentry SDK.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize the library.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All errors will be reported to Sentry now.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="rollbar"><a class="anchor" href="#rollbar"></a>6.1.2. Rollbar</h4>
<div class="paragraph">
<p><a href="https://docs.rollbar.com/docs/python">
Rollbar for Python documentation.
</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install rollbar <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install the library.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import rollbar.logger  <i class="conum" data-value="1"></i><b>(1)</b>

from corva import Api, TaskEvent, task

rollbar_handler = rollbar.logger.RollbarHandler('YOUR_ROLLBAR_ACCESS_TOKEN')  <i class="conum" data-value="2"></i><b>(2)</b>


@task(handler=rollbar_handler)  <i class="conum" data-value="3"></i><b>(3)</b>
def app(event: TaskEvent, api: Api) -&gt; None:
    1 / 0  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import Rollbar SDK.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize Rollbar handler.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pass the handler as a keyword argument to the app decorator.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>All errors will be reported to Rollbar now.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_raygun"><a class="anchor" href="#_raygun"></a>6.1.3. Raygun</h4>
<div class="paragraph">
<p><a href="https://raygun.com/documentation/language-guides/python/crash-reporting/installation/">
Raygun for Python documentation.
</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install raygun4py <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install the library.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import raygun4py.raygunprovider  <i class="conum" data-value="1"></i><b>(1)</b>

from corva import Api, TaskEvent, task

raygun_handler = raygun4py.raygunprovider.RaygunHandler('YOUR_RAYGUN_API_KEY')  <i class="conum" data-value="2"></i><b>(2)</b>


@task(handler=raygun_handler)  <i class="conum" data-value="3"></i><b>(3)</b>
def app(event: TaskEvent, api: Api) -&gt; None:
    1 / 0  <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import Raygun SDK.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Initialize Raygun handler.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Pass the handler as a keyword argument to the app decorator.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>All errors will be reported to Raygun now.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_other_libraries"><a class="anchor" href="#_other_libraries"></a>6.1.4. Other libraries</h4>
<div class="paragraph">
<p>You can use any other error logging libraries.
Just initialize
and pass corresponding logging handler
as a keyword argument to the app decorator.
Use code samples above as the examples.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_followable_apps"><a class="anchor" href="#_followable_apps"></a>7. Followable apps</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only <a href="#stream"><code>stream</code></a>
and <a href="#scheduled"><code>scheduled</code></a>
apps can be followed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An app is called followable once
it can be followed by other ones.
Followable apps must produce
data to trigger
chain reaction of following app runs.
See <a href="#produce_messages">Produce messages</a> and <a href="#insert_data">Insert data</a> sections
for instructions on how to produce
messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, StreamTimeEvent, scheduled, stream


@scheduled  <i class="conum" data-value="1"></i><b>(1)</b>
def followable_scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    data = [
        {
            'asset_id': event.asset_id,
            'version': 1,
            'timestamp': 0,
            'data': {'answer': 10},
        },
        {
            'asset_id': event.asset_id,
            'version': 1,
            'timestamp': 60,
            'data': {'answer': 11},
        },
    ]  <i class="conum" data-value="2"></i><b>(2)</b>

    <i class="conum" data-value="3"></i><b>(3)</b>
    api.insert_data(
        provider='my-provider',
        dataset='quiz-answers',
        data=data,
    )  <i class="conum" data-value="4"></i><b>(4)</b>
    api.produce_messages(data=data)  <i class="conum" data-value="5"></i><b>(5)</b>

    <i class="conum" data-value="6"></i><b>(6)</b>
    api.insert_data(
        provider='my-provider',
        dataset='quiz-answers',
        data=data,
        produce=True,  <i class="conum" data-value="7"></i><b>(7)</b>
    )


@scheduled  <i class="conum" data-value="8"></i><b>(8)</b>
def following_scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):
    data = api.get_dataset(
        provider='my-provider',
        dataset='quiz-answers',
        query={'asset_id': event.asset_id, 'company_id': event.company_id},
        sort={'timestamp': 1},
        limit=2,
    )  <i class="conum" data-value="9"></i><b>(9)</b>

    assert [datum['data'] for datum in data] == [
        {'answer': 10},
        {'answer': 11},
    ]


@stream  <i class="conum" data-value="10"></i><b>(10)</b>
def following_stream_app(event: StreamTimeEvent, api: Api, cache: Cache):
    assert [record.data for record in event.records] == [
        {'answer': 10},
        {'answer': 11},
    ]  <i class="conum" data-value="11"></i><b>(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The followable app.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Data documents that should be
saved and produced.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>Slow</strong> method which uses two api
calls.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>First save the data to the dataset.
See <a href="#insert_data">Insert data</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Then produce the messages.
See <a href="#produce_messages">Produce messages</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><strong>Recommended</strong> method which
uses single api call.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Enable this flag to save and
produce messages at once.
See <a href="#insert_data">Insert data</a> for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Example scheduled following app.
It will be invoked as soon as there
is some time interval worth of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Scheduled apps should query the data
as unlike stream ones they don&#8217;t
receive it in the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Example stream following app.
It will be invoked as soon as new
messages are produced.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Stream apps receive data straight
from the event. No api calls needed.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secrets"><a class="anchor" href="#_secrets"></a>8. Secrets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can store sensitive data such as passwords,
tokens,
confidential configuration data,
or any other types of data that you want to protect
as application secrets.
To access such data inside the app
<strong>corva-sdk</strong> provides <code>secrets</code> object.</p>
</div>
<div class="paragraph">
<p>See <a href="#testing_secrets"><code>testing secrets</code></a> section
to see how to test an app
that uses secrets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, secrets, task  <i class="conum" data-value="1"></i><b>(1)</b>


@task
def task_app(event: TaskEvent, api: Api):
    secrets['api_token']  <i class="conum" data-value="2"></i><b>(2)</b>
    int(secrets['integer'])  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import <code>secrets</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>secrets</code> is a dictionary so
use key to retrieve the value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Values are stored as strings,
cast the value to required type as needed.
Example shows how to get the integer.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing"><a class="anchor" href="#_testing"></a>9. Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testing apps is easy and enjoyable.</p>
</div>
<div class="paragraph">
<p><strong>corva-sdk</strong> provides convenient tools for testing through
<a href="https://docs.pytest.org/en/stable/writing_plugins.html">pytest-plugin</a>.</p>
</div>
<div class="paragraph">
<p>Write your tests using <code>pytest</code> to get the access to the plugin.</p>
</div>
<div class="paragraph">
<p>To install the library run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install pytest</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_stream"><a class="anchor" href="#_stream"></a>9.1. Stream</h3>
<div class="sect3">
<h4 id="_time"><a class="anchor" href="#_time"></a>9.1.1. Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, StreamTimeEvent, StreamTimeRecord, stream


@stream
def stream_app(event: StreamTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_stream_time_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = StreamTimeEvent(  <i class="conum" data-value="3"></i><b>(3)</b>
        asset_id=0, company_id=0, records=[StreamTimeRecord(timestamp=0)]
    )

    result = app_runner(stream_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_depth"><a class="anchor" href="#_depth"></a>9.1.2. Depth</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, StreamDepthEvent, StreamDepthRecord, stream


@stream
def stream_app(event: StreamDepthEvent, api: Api, cache: Cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_stream_depth_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = StreamDepthEvent(  <i class="conum" data-value="3"></i><b>(3)</b>
        asset_id=0, company_id=0, records=[StreamDepthRecord(measured_depth=0)]
    )

    result = app_runner(stream_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduled"><a class="anchor" href="#_scheduled"></a>9.2. Scheduled</h3>
<div class="sect3">
<h4 id="_data_time"><a class="anchor" href="#_data_time"></a>9.2.1. Data Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDataTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDataTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_scheduled_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = ScheduledDataTimeEvent(
        asset_id=0, start_time=0, end_time=0, company_id=0
    )  <i class="conum" data-value="3"></i><b>(3)</b>

    result = app_runner(scheduled_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_depth_2"><a class="anchor" href="#_depth_2"></a>9.2.2. Depth</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledDepthEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledDepthEvent, api: Api, cache: Cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_scheduled_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = ScheduledDepthEvent(
        asset_id=0,
        company_id=0,
        top_depth=0.0,
        bottom_depth=1.0,
        log_identifier='',
        interval=1.0,
    )  <i class="conum" data-value="3"></i><b>(3)</b>

    result = app_runner(scheduled_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_natural_time"><a class="anchor" href="#_natural_time"></a>9.2.3. Natural Time</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, Cache, ScheduledNaturalTimeEvent, scheduled


@scheduled
def scheduled_app(event: ScheduledNaturalTimeEvent, api: Api, cache: Cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_scheduled_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = ScheduledNaturalTimeEvent(
        asset_id=0, company_id=0, schedule_start=0, interval=1
    )  <i class="conum" data-value="3"></i><b>(3)</b>

    result = app_runner(scheduled_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_task"><a class="anchor" href="#_task"></a>9.3. Task</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, task


@task
def task_app(event: TaskEvent, api: Api):  <i class="conum" data-value="1"></i><b>(1)</b>
    return 'Hello, World!'


def test_task_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = TaskEvent(asset_id=0, company_id=0)  <i class="conum" data-value="3"></i><b>(3)</b>

    result = app_runner(task_app, event=event)  <i class="conum" data-value="4"></i><b>(4)</b>

    assert result == 'Hello, World!'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing_secrets"><a class="anchor" href="#testing_secrets"></a>9.4. Secrets</h3>
<div class="paragraph">
<p>This section shows
how to test an app that uses secrets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import Api, TaskEvent, secrets, task


@task
def task_app(event: TaskEvent, api: Api):  <i class="conum" data-value="1"></i><b>(1)</b>
    api_token = secrets['api_token']

    return api_token


def test_task_app(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = TaskEvent(asset_id=0, company_id=0)  <i class="conum" data-value="3"></i><b>(3)</b>

    api_token = app_runner(task_app, event, secrets={'api_token': '12345'})  <i class="conum" data-value="4"></i><b>(4)</b>

    assert api_token == '12345'  <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.
Pass dictionary with required secrets
as <code>secrets</code> parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cache"><a class="anchor" href="#_cache"></a>9.5. Cache</h3>
<div class="paragraph">
<p>This section shows how to test an app that uses cache;
reuse the same cache or reset it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from corva import ScheduledDataTimeEvent, scheduled
from corva.service.cache_sdk import UserRedisSdk


@scheduled
def scheduled_fibonacci(event, api, cache):  <i class="conum" data-value="1"></i><b>(1)</b>
    number1 = int(cache.get('number1') or 1)
    number2 = int(cache.get('number2') or 1)
    number3 = number1 + number2
    cache.set('number1', number2)
    cache.set('number2', number3)

    return number3


def test_reset_cache(app_runner):  <i class="conum" data-value="2"></i><b>(2)</b>
    event = ScheduledDataTimeEvent(
        asset_id=0, company_id=0, start_time=0, end_time=0
    )  <i class="conum" data-value="3"></i><b>(3)</b>

    for _ in range(5):
        result = app_runner(scheduled_fibonacci, event)  <i class="conum" data-value="4"></i><b>(4)</b>
        assert result == 2  <i class="conum" data-value="5"></i><b>(5)</b>


def test_reuse_cache(app_runner):  <i class="conum" data-value="6"></i><b>(6)</b>
    event = ScheduledDataTimeEvent(
        asset_id=0, company_id=0, start_time=0, end_time=0
    )  <i class="conum" data-value="7"></i><b>(7)</b>

    cache = UserRedisSdk(
        hash_name='hash_name', redis_dsn='redis://localhost', use_fakes=True
    )  <i class="conum" data-value="8"></i><b>(8)</b>

    expected_results = [2, 3, 5, 8, 13, 21, 34, 55]
    for expected_result in expected_results:
        result = app_runner(scheduled_fibonacci, event, cache=cache)  <i class="conum" data-value="9"></i><b>(9)</b>
        assert result == expected_result  <i class="conum" data-value="10"></i><b>(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sample app that we want to test.
It is a sample Fibonacci function that is relying on cache data;
it receives two numbers from the cache, compute the sum and store
the last two numbers in the cache.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>app_runner</code> argument to your test function.
In this test case, the cache is reset for each <code>app_runner</code> call.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use <code>app_runner</code> fixture to run the app.
When the <code>cache</code> kwargs is not passed to the <code>app_runner</code>,
it will reset everytime it is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the result.
Since the cache is reset for each <code>app_runner</code> call, the results are the same.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Add <code>app_runner</code> argument to your test function.
In this test case, the cache is reused for each <code>app_runner</code> call.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Define the <a href="#event">event</a> that will be passed to the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Defining a cache object.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Use <code>app_runner</code> fixture to run the app.
When the <code>cache</code> is passed in the <code>app_runner</code>,
it will be used to run the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Verify the result.
Since the same cache object is used, the results are changing.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_app_rerun"><a class="anchor" href="#_app_rerun"></a>10. App rerun</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You might want to implement custom logic for app rerun,
for this events include <code>rerun</code> field
that stores rerun metadata.</p>
</div>
<div class="paragraph">
<p>Example usage scenario of <code>rerun</code> field:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Well start 22/01/31 - end 22/03/31.</p>
</li>
<li>
<p>Rerun start 22/02/02 - end 22/02/04.</p>
</li>
<li>
<p>By default app uses the latest calculated record
as the base to catch up to real-time.</p>
</li>
<li>
<p>During rerun app must use the latest record before 22/02/02 (using <code>rerun.start</code>)
as the base for the initial calculation.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_contributing"><a class="anchor" href="#_development_contributing"></a>11. Development - Contributing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here are some guidelines to set up your environment.</p>
</div>
<div class="sect2">
<h3 id="_create_and_activate_virtual_environment"><a class="anchor" href="#_create_and_activate_virtual_environment"></a>11.1. Create and activate virtual environment</h3>
<div class="paragraph">
<p>What&#8217;s needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Python 3.8.</p>
</li>
<li>
<p>Opened terminal inside cloned <strong>corva-sdk</strong> repository.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -m venv env <i class="conum" data-value="1"></i><b>(1)</b>
source ./env/bin/activate <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a directory <code>./env/</code>
with isolated Python environment inside.
You will be able to install needed packages there.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activate the new environment.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From now on
you must always have activated virtual environment
when working with the project.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_install_dependencies_and_run_tests"><a class="anchor" href="#_install_dependencies_and_run_tests"></a>11.2. Install dependencies and run tests</h3>
<div class="paragraph">
<p>What&#8217;s needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installed <code>make</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">make install <i class="conum" data-value="1"></i><b>(1)</b>
make all  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Install all development requirements.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run tests and linter
to verify that the project was set up properly.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whats_next"><a class="anchor" href="#_whats_next"></a>11.3. What&#8217;s next?</h3>
<div class="paragraph">
<p>After completing steps above
you can explore the project
and make a contribution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">make help <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>List available <code>make</code> targets -
a good starting point for exploration.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
